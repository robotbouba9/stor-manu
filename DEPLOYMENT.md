# دليل النشر على Render

هذا الدليل يوضح كيفية نشر تطبيق إدارة مخزون محل الهواتف على منصة Render.

## المتطلبات المسبقة

1. **حساب على Render**: قم بإنشاء حساب مجاني على [render.com](https://render.com)
2. **مستودع GitHub**: تأكد من أن المشروع موجود على GitHub
3. **ملفات التكوين**: تأكد من وجود جميع الملفات المطلوبة (تم إضافتها بالفعل)

## الملفات المضافة للنشر

### 1. `Procfile`
يحدد كيفية تشغيل التطبيق على Render:
```
web: gunicorn src.main:app --bind 0.0.0.0:$PORT
```

### 2. `requirements.txt` (محدث)
يحتوي على جميع المكتبات المطلوبة بما في ذلك:
- `gunicorn`: خادم WSGI للإنتاج
- `psycopg2-binary`: للاتصال بـ PostgreSQL
- `python-dotenv`: لإدارة متغيرات البيئة

### 3. `src/config.py`
إدارة إعدادات التطبيق والبيئة:
- دعم SQLite للتطوير المحلي
- دعم PostgreSQL للنشر
- إدارة متغيرات البيئة

### 4. `.env.example`
مثال على متغيرات البيئة المطلوبة

### 5. `render.yaml` (اختياري)
تكوين تلقائي للنشر على Render

## خطوات النشر

### الطريقة الأولى: النشر اليدوي عبر لوحة التحكم

#### 1. إنشاء قاعدة بيانات PostgreSQL

1. سجل الدخول إلى [Render Dashboard](https://dashboard.render.com)
2. اضغط على **"New +"** واختر **"PostgreSQL"**
3. املأ التفاصيل:
   - **Name**: `phone-store-db`
   - **Database**: `phone_store`
   - **User**: `phone_store_user`
   - **Region**: اختر المنطقة الأقرب لك
   - **PostgreSQL Version**: اختر أحدث إصدار
   - **Plan**: اختر **"Free"** للاختبار
4. اضغط **"Create Database"**
5. انتظر حتى يتم إنشاء قاعدة البيانات (قد يستغرق بضع دقائق)
6. احفظ **"Internal Database URL"** من صفحة تفاصيل قاعدة البيانات

#### 2. إنشاء خدمة الويب

1. في لوحة التحكم، اضغط **"New +"** واختر **"Web Service"**
2. اختر **"Build and deploy from a Git repository"**
3. اربط حساب GitHub الخاص بك إذا لم تفعل ذلك بعد
4. اختر مستودع `stor-manu`
5. املأ التفاصيل:
   - **Name**: `phone-store-app`
   - **Region**: نفس منطقة قاعدة البيانات
   - **Branch**: `master`
   - **Root Directory**: اتركه فارغاً
   - **Runtime**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `gunicorn src.main:app`

#### 3. إعداد متغيرات البيئة

في قسم **"Environment Variables"**، أضف المتغيرات التالية:

```
FLASK_ENV=production
SECRET_KEY=your-super-secret-key-here-make-it-long-and-random
JWT_SECRET_KEY=your-jwt-secret-key-here-also-long-and-random
DATABASE_URL=postgresql://username:password@hostname:port/database_name
```

**مهم**: استبدل `DATABASE_URL` بالرابط الذي حصلت عليه من قاعدة البيانات في الخطوة 1.

#### 4. النشر

1. اضغط **"Create Web Service"**
2. سيبدأ Render في بناء ونشر التطبيق
3. انتظر حتى يكتمل النشر (قد يستغرق 5-10 دقائق)
4. ستحصل على رابط التطبيق مثل: `https://phone-store-app.onrender.com`

### الطريقة الثانية: النشر التلقائي باستخدام render.yaml

1. تأكد من وجود ملف `render.yaml` في جذر المشروع
2. في لوحة تحكم Render، اضغط **"New +"** واختر **"Blueprint"**
3. اختر مستودع GitHub
4. سيقوم Render بقراءة ملف `render.yaml` وإنشاء الخدمات تلقائياً

## اختبار التطبيق

بعد النشر الناجح:

1. افتح رابط التطبيق في المتصفح
2. أضف `/simple_app.html` إلى نهاية الرابط
3. مثال: `https://phone-store-app.onrender.com/simple_app.html`
4. اختبر الوظائف الأساسية:
   - تهيئة الإعدادات الافتراضية
   - إضافة منتج جديد
   - عرض لوحة التحكم

## استكشاف الأخطاء

### مشاكل شائعة وحلولها

#### 1. خطأ في الاتصال بقاعدة البيانات
```
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError)
```
**الحل**: تأكد من صحة `DATABASE_URL` في متغيرات البيئة

#### 2. خطأ في تثبيت المكتبات
```
ERROR: Could not install packages
```
**الحل**: تأكد من صحة ملف `requirements.txt`

#### 3. التطبيق لا يبدأ
```
Application failed to start
```
**الحل**: تحقق من سجلات Render وتأكد من صحة `Procfile`

#### 4. خطأ 502 Bad Gateway
**الحل**: تأكد من أن التطبيق يستمع على المنفذ الصحيح (`$PORT`)

### عرض السجلات

1. في لوحة تحكم Render، اذهب إلى خدمة التطبيق
2. اضغط على تبويب **"Logs"**
3. راجع الأخطاء والرسائل

## الصيانة والتحديث

### تحديث التطبيق

1. قم بدفع التغييرات إلى GitHub
2. سيقوم Render بإعادة النشر تلقائياً
3. راقب سجلات النشر للتأكد من نجاح العملية

### النسخ الاحتياطي

1. في لوحة تحكم قاعدة البيانات، اضغط **"Backups"**
2. يمكنك إنشاء نسخة احتياطية يدوية أو جدولة نسخ تلقائية

### مراقبة الأداء

1. راقب استخدام الموارد في لوحة التحكم
2. تحقق من أوقات الاستجابة
3. راجع السجلات بانتظام

## الترقية من الخطة المجانية

الخطة المجانية لها قيود:
- التطبيق ينام بعد 15 دقيقة من عدم النشاط
- 750 ساعة تشغيل شهرياً
- قاعدة بيانات محدودة الحجم

للاستخدام التجاري، فكر في الترقية إلى خطة مدفوعة.

## الأمان

### في الإنتاج، تأكد من:

1. **استخدام مفاتيح أمان قوية**: لا تستخدم المفاتيح الافتراضية
2. **تحديث المكتبات بانتظام**: للحصول على تحديثات الأمان
3. **مراجعة السجلات**: لرصد أي نشاط مشبوه
4. **تقييد CORS**: حدد النطاقات المسموحة في الإنتاج

## الدعم

إذا واجهت مشاكل:
1. راجع [وثائق Render](https://render.com/docs)
2. تحقق من [منتدى المجتمع](https://community.render.com)
3. راجع سجلات التطبيق وقاعدة البيانات

## ملاحظات مهمة

- **وقت البدء البارد**: التطبيقات المجانية قد تستغرق 30-60 ثانية للاستيقاظ
- **المنطقة الجغرافية**: اختر منطقة قريبة من المستخدمين لتحسين الأداء
- **النسخ الاحتياطي**: قم بعمل نسخ احتياطية منتظمة لقاعدة البيانات
- **المراقبة**: راقب استخدام الموارد وأداء التطبيق

---

تم إعداد هذا الدليل لضمان نشر ناجح وآمن لتطبيق إدارة مخزون محل الهواتف على Render.

